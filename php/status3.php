<?php // update main page of the websiteinclude "dbinfo.php";$name = preg_replace("/[^0-9]/", "", $_GET['name']);$db = new PDO("mysql:host=$dbhost;dbname=$dbname", $dbuser, $dbpass); // connect to the database$query = $db->query("SELECT * FROM currentplayers"); $resultall = $query->fetchAll(PDO::FETCH_ASSOC); $resultall = array_filter($resultall);/*$db = new mysqli($dbhost, $dbuser, $dbpass, $dbname);$query = $db->query("SELECT * FROM currentplayers");$resultall = array();while ($row = mysqli_fetch_assoc($query)) { $resultall[] = $row; } // fetching results*/if (empty($name)) { $name = '0'; } // fix for empty user valuefunction isadded($array, $key, $val) {    foreach ($array as $item)        if (isset($item[$key]) && $item[$key] == $val)            return true;    return false;}$added = isadded($resultall, 'name', $name);$resultall[0]['checkadded'] = $added;$query = $db->query("SELECT * FROM maps");$rowcount = $query->rowCount();$resultlist = $query->fetchAll(PDO::FETCH_ASSOC); $resultlist = array_filter($resultlist);/*$resultlist = array(); $rowcount = 0;while ($row = mysqli_fetch_assoc($query)) { $resultlist[] = $row; $rowcount = $rowcount + 1;} // fetching results*/$nplayers = 0;$maparray = array();for ($i = 0; $i < 18; $i++) {	if ($resultall[$i]['name'] == $name) { $resultall[0]['checkready'] = $resultall[$i]['ready']; }	$nready = $nready + $resultall[$i]['ready'];	$gameurl = $gameurl + $resultall[$i]['name'] + $resultall[$i]['map'];	if ($resultall[$i]['map'] != null) {		array_push($maparray, $resultall[$i]['map']);	}	if ($resultall[$i]['name'] != null) {		$nplayers = $nplayers + 1;	}}$resultall[0]['nplayers'] = $nplayers;$resultall[0]['nready'] = $nready;$resultall[0]['gameurl'] = md5($gameurl);$votecount = array_count_values($maparray);$resultall[0]['maps'] = "";if (!empty($votecount)) {	for ($i = 0; $i < $rowcount; $i++) {		if ($votecount[$i] != null) {//			$result['maps'] = "&#60;p&#62;".$resultlist[$i]['name']." (x ".$votecount[$i].")&#60;&#47;p&#62;".$result['maps'];			$resultall[0]['maps'] = $resultlist[$i]['name']." (x ".$votecount[$i].")<br>".$resultall[0]['maps'];		}	}}else {	$resultall[0]['maps'] = "No votes yet";}//echo '{"players":'.json_encode($result).'}';header('Content-Type: application/json');echo json_encode($resultall);?>