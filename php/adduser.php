<?php // add user/player to the database/pickupsession_start();include "dbinfo.php";$name = preg_replace("/[^0-9]/", "", $_GET['name']);//$nickname = $_GET['nick'];$nickname = preg_replace("/[^A-Za-z0-9-_]/", "", $_GET['nick']);$class = preg_replace("/[^A-Za-z0-9]/", "", $_GET['class']);$team = preg_replace("/[^A-Za-z0-9]/", "", $_GET['team']);//	check if the variables were not passedif ( $name == null or $name == '' or empty($name) or !isset($name) or !isset($class) or !isset($team) or !isset($nickname) ) {	return false;}else { // if values are passed/*********************************************************************************/	if ($name = $_SESSION['playersteamid64']) {		$db = new PDO("mysql:host=$dbhost;dbname=$dbname", $dbuser, $dbpass); // connect to the database		$query = $db->query("SELECT * FROM currentplayers WHERE class='$class' AND team='$team'"); // search for player name/nick of certain class/team		$result = $query->fetchAll(PDO::FETCH_ASSOC); $result = array_filter($result); print_r($result);// fetch results		if ( $name !== $result[0]['name'] AND $result[0]['name'] !== '' AND $result[0]['name'] !== null ) { // if somebody else is occupying this class/team			return false; // do nothing		}		else { // otherwise			$query = $db->query("SELECT * FROM currentplayers WHERE name='$name'"); // look if player is already in db			$result = $query->fetchAll(PDO::FETCH_ASSOC); $result = array_filter($result); print_r($result);// fetch results			if (isset($result[0]['name'])) { // if player is already on the list				$query = $db->query("UPDATE currentplayers SET name='', nickname='', ready='0', map='' WHERE team='".$result[0]['team']."' AND class='".$result[0]['class']."'");				$query = $db->query("UPDATE currentplayers SET name='$name', nickname='$nickname', ready='0', map='".$result[0]['map']."' WHERE team='$team' AND class='$class'");			} else {				$query = $db->query("UPDATE currentplayers SET name='$name', nickname='$nickname', ready='0', map='' WHERE team='$team' AND class='$class'");			}		}	}/*********************************************************************************/}?>